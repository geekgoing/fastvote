# Architecture

## 로컬 개발 구성

```text
┌─────────────────┐     WebSocket      ┌─────────────────┐
│                 │◄──────────────────►│                 │
│    Frontend     │                    │     Backend     │
│   (Next.js)     │────── REST ───────►│   (FastAPI)     │
│   Port: 3000    │                    │   Port: 8000    │
└─────────────────┘                    └────────┬────────┘
                                                │
                                       ┌────────▼────────┐
                                       │      Redis      │
                                       │   Port: 6379    │
                                       └─────────────────┘
```

## 배포 구성 (Ingress 라우팅 기준)

```text
                    ┌─────────────────────────────────────┐
                    │            Ingress                  │
    Browser ───────►│  /api/* /ws/* → backend:8000       │
                    │  /*           → frontend:3000       │
                    └───────────────┬─────────────────────┘
                                    │
              ┌─────────────────────┼─────────────────────┐
              │                     │                     │
              ▼                     ▼                     ▼
     ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐
     │    Frontend     │   │     Backend     │   │      Redis      │
     │   (Next.js)     │   │   (FastAPI)     │   │   (in-memory)   │
     └─────────────────┘   └────────┬────────┘   └─────────────────┘
                                    │                     ▲
                                    └─────────────────────┘
```

## 요청 흐름

1. 사용자가 프론트엔드에서 투표 생성/조회 요청
2. 프론트엔드가 `/api/*` 경로로 백엔드 REST API 호출
3. 백엔드가 Redis에 투표방/투표결과/댓글 저장
4. 투표 발생 시 백엔드가 `/ws/rooms/{uuid}` 구독자에게 결과 브로드캐스트
5. 프론트엔드가 실시간 차트 UI 업데이트

## 데이터 저장 전략

- `room:{uuid}`: 투표 메타데이터
- `votes:{uuid}`: 선택지별 집계 결과
- `comments:{uuid}`: 댓글 목록
- `voted:{uuid}:{fingerprint}`: 중복 투표 방지 키
- Redis TTL로 투표/댓글 데이터 자동 만료
